{
  "components":{
     "comp-importer":{
        "executorLabel":"exec-importer",
        "inputDefinitions":{
           "parameters":{
              "uri":{
                 "parameterType":"STRING"
              }
           }
        },
        "outputDefinitions":{
           "artifacts":{
              "artifact":{
                 "artifactType":{
                    "schemaTitle":"google.VertexBatchPredictionJob",
                    "schemaVersion":"0.0.1"
                 }
              }
           }
        }
     },
     "comp-model-evaluation":{
        "executorLabel":"exec-model-evaluation",
        "inputDefinitions":{
           "artifacts":{
              "batch_prediction_job":{
                 "artifactType":{
                    "schemaTitle":"google.VertexBatchPredictionJob",
                    "schemaVersion":"0.0.1"
                 }
              }
           },
           "parameters":{
              "class_names":{
                 "parameterType":"LIST"
              },
              "classification_type":{
                 "parameterType":"STRING"
              },
              "ground_truth_column":{
                 "parameterType":"STRING"
              },
              "location":{
                 "parameterType":"STRING"
              },
              "predictions_format":{
                 "parameterType":"STRING"
              },
              "problem_type":{
                 "parameterType":"STRING"
              },
              "project":{
                 "parameterType":"STRING"
              },
              "root_dir":{
                 "parameterType":"STRING"
              }
           }
        },
        "outputDefinitions":{
           "artifacts":{
              "evaluation_metrics":{
                 "artifactType":{
                    "schemaTitle":"system.Metrics",
                    "schemaVersion":"0.0.1"
                 }
              }
           }
        }
     }
  },
  "deploymentSpec":{
     "executors":{
        "exec-importer":{
           "importer":{
              "artifactUri":{
                 "constant":"asd"
              },
              "metadata":{
                 "job_resource_name":"batch-prediction-job-resource-name",
                 "name":"batch-prediction-name",
                 "uri":"batch-prediction-uri"
              },
              "typeSchema":{
                 "schemaTitle":"google.VertexBatchPredictionJob",
                 "schemaVersion":"0.0.1"
              }
           }
        },
        "exec-model-evaluation":{
           "container":{
              "args":[
                 "--setup_file",
                 "/setup.py",
                 "--json_mode",
                 "true",
                 "--project_id",
                 "{{$.inputs.parameters['project']}}",
                 "--location",
                 "{{$.inputs.parameters['location']}}",
                 "--problem_type",
                 "{{$.inputs.parameters['problem_type']}}",
                 "--batch_prediction_format",
                 "{{$.inputs.parameters['predictions_format']}}",
                 "--batch_prediction_gcs_source",
                 "{{$.inputs.artifacts['batch_prediction_job'].metadata['gcsOutputDirectory']}}",
                 "--root_dir",
                 "{{$.inputs.parameters['root_dir']}}/{{$.pipeline_job_uuid}}-{{$.pipeline_task_uuid}}",
                 "--classification_type",
                 "{{$.inputs.parameters['classification_type']}}",
                 "--class_names",
                 "{{$.inputs.parameters['class_names']}}",
                 "--ground_truth_column",
                 "instance.{{$.inputs.parameters['ground_truth_column']}}",
                 "--prediction_score_column",
                 "--prediction_label_column",
                 "--prediction_id_column",
                 "--example_weight_column",
                 "--positive_classes",
                 "--generate_feature_attribution",
                 "--dataflow_job_prefix",
                 "evaluation-{{$.pipeline_job_uuid}}-{{$.pipeline_task_uuid}}",
                 "--dataflow_disk_size",
                 "--dataflow_machine_type",
                 "--dataflow_workers_num",
                 "--dataflow_max_workers_num",
                 "--output_metrics_gcs_path",
                 "{{$.outputs.artifacts['evaluation_metrics'].uri}}",
                 "--executor_input",
                 "{{$}}"
              ],
              "command":[
                 "python",
                 "/main.py"
              ],
              "image":"gcr.io/ml-pipeline/model-evaluation:v0.1"
           }
        }
     }
  },
  "pipelineInfo":{
     "name":"evaluation-test"
  },
  "root":{
     "dag":{
        "outputs":{
           "artifacts":{
              "model-evaluation-evaluation_metrics":{
                 "artifactSelectors":[
                    {
                       "outputArtifactKey":"evaluation_metrics",
                       "producerSubtask":"model-evaluation"
                    }
                 ]
              }
           }
        },
        "tasks":{
           "importer":{
              "cachingOptions":{
                 "enableCache":true
              },
              "componentRef":{
                 "name":"comp-importer"
              },
              "inputs":{
                 "parameters":{
                    "uri":{
                       "runtimeValue":{
                          "constant":"asd"
                       }
                    }
                 }
              },
              "taskInfo":{
                 "name":"importer"
              }
           },
           "model-evaluation":{
              "cachingOptions":{
                 "enableCache":true
              },
              "componentRef":{
                 "name":"comp-model-evaluation"
              },
              "dependentTasks":[
                 "importer"
              ],
              "inputs":{
                 "artifacts":{
                    "batch_prediction_job":{
                       "taskOutputArtifact":{
                          "outputArtifactKey":"artifact",
                          "producerTask":"importer"
                       }
                    }
                 },
                 "parameters":{
                    "class_names":{
                       "runtimeValue":{
                          "constant":[
                             "test-class-1",
                             "test-class-2"
                          ]
                       }
                    },
                    "classification_type":{
                       "runtimeValue":{
                          "constant":"test-classification-type"
                       }
                    },
                    "ground_truth_column":{
                       "runtimeValue":{
                          "constant":"test-ground-truth-column"
                       }
                    },
                    "location":{
                       "runtimeValue":{
                          "constant":"us-central1"
                       }
                    },
                    "predictions_format":{
                       "runtimeValue":{
                          "constant":"test-predictions-format"
                       }
                    },
                    "problem_type":{
                       "runtimeValue":{
                          "constant":"test-problem-type"
                       }
                    },
                    "project":{
                       "runtimeValue":{
                          "constant":"test-project"
                       }
                    },
                    "root_dir":{
                       "runtimeValue":{
                          "constant":"test-directory"
                       }
                    }
                 }
              },
              "taskInfo":{
                 "name":"model-evaluation"
              }
           }
        }
     },
     "outputDefinitions":{
        "artifacts":{
           "model-evaluation-evaluation_metrics":{
              "artifactType":{
                 "schemaTitle":"system.Metrics",
                 "schemaVersion":"0.0.1"
              }
           }
        }
     }
  }
}